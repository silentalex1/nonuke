<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://chrome.google.com; style-src 'self' 'unsafe-inline'; font-src 'self' https://fonts.googleapis.com https://fonts.gstatic.com; connect-src 'self' https://clients2.google.com https://chrome.google.com;">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-Frame-Options" content="DENY">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>Nexus Elite</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e40af;
            --secondary: #7e22ce;
            --success: #15803d;
            --error: #b91c1c;
            --neutral: #4b5563;
            --bg: #f1f5f9;
            --panel: rgba(255, 255, 255, 0.98);
            --text: #1e293b;
            --shadow: rgba(0, 0, 0, 0.12);
            --glow: rgba(30, 64, 175, 0.3);
            --accent: #d97706;
            --curve: 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            overflow: hidden;
            overscroll-behavior: none;
        }
        .backdrop {
            position: fixed;
            inset: 0;
            background: linear-gradient(155deg, rgba(30, 64, 175, 0.06), rgba(126, 34, 206, 0.06));
            z-index: -1;
        }
        .pulse-ring {
            position: absolute;
            width: 200px;
            height: 200px;
            background: rgba(30, 64, 175, 0.05);
            border-radius: 50%;
            animation: pulse-ring 15s infinite ease-in-out;
            will-change: transform, opacity;
        }
        .pulse-ring:nth-child(1) { top: 10%; left: 30%; }
        .pulse-ring:nth-child(2) { top: 75%; left: 65%; }
        .pulse-ring:nth-child(3) { top: 40%; left: 15%; }
        .elite {
            background: var(--panel);
            padding: 3.25rem;
            border-radius: 2.5rem;
            box-shadow: 0 30px 80px var(--shadow);
            max-width: 540px;
            width: 95%;
            position: relative;
            z-index: 1;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.4);
            transition: transform var(--curve);
        }
        .elite:hover { transform: translateY(-12px); }
        h1 {
            font-size: 2.85rem;
            font-weight: 800;
            color: var(--text);
            text-align: center;
            margin-bottom: 2.75rem;
            letter-spacing: 1px;
        }
        h1 span { color: var(--primary); text-shadow: 0 4px 12px var(--glow); }
        .input-zone {
            position: relative;
            margin-bottom: 2.5rem;
        }
        input {
            width: 100%;
            padding: 1.75rem 5rem 1.75rem 2rem;
            border: 1px solid #d1d5db;
            border-radius: 1.75rem;
            font-size: 1.2rem;
            color: var(--text);
            background: #fff;
            outline: none;
            transition: border-color var(--curve), box-shadow var(--curve);
        }
        input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 20px var(--glow);
        }
        .input-signal {
            position: absolute;
            right: 2rem;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 1.6rem;
            transition: color var(--curve);
        }
        input:focus + .input-signal { color: var(--primary); }
        .deploy-btn {
            width: 100%;
            padding: 1.75rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            border: none;
            border-radius: 1.75rem;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all var(--curve);
        }
        .deploy-btn:hover {
            box-shadow: 0 18px 40px var(--glow);
            transform: translateY(-8px);
        }
        .deploy-btn:active { transform: scale(0.96); }
        .deploy-btn.loading {
            background: #6b7280;
            cursor: wait;
            pointer-events: none;
        }
        .deploy-btn.loading::after {
            content: '';
            position: absolute;
            width: 30px;
            height: 30px;
            border: 5px solid #fff;
            border-top-color: transparent;
            border-radius: 50%;
            animation: spin 0.45s linear infinite;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .alert {
            margin-top: 2.25rem;
            padding: 1.75rem 2.25rem;
            font-size: 1.1rem;
            font-weight: 400;
            color: var(--text);
            background: #fff;
            border-radius: 1.75rem;
            box-shadow: 0 10px 35px var(--shadow);
            opacity: 0;
            transform: translateY(30px);
            transition: all 0.45s ease;
            word-break: break-word;
            max-width: 100%;
        }
        .alert.show {
            opacity: 1;
            transform: translateY(0);
        }
        .ledger {
            margin-top: 2.75rem;
            max-height: 280px;
            overflow-y: auto;
            background: #fff;
            border-radius: 1.75rem;
            padding: 2rem;
            box-shadow: 0 10px 35px var(--shadow);
            display: none;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) #e5e7eb;
        }
        .ledger.show { display: block; }
        .ledger::-webkit-scrollbar { width: 12px; }
        .ledger::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 6px; }
        .ledger::-webkit-scrollbar-track { background: #e5e7eb; }
        .ledger-entry {
            padding: 1.5rem 0;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.05rem;
            color: var(--text);
            transition: background var(--curve);
        }
        .ledger-entry:last-child { border-bottom: none; }
        .ledger-entry:hover { background: var(--glow); }
        .ledger-entry .redo {
            color: var(--accent);
            font-weight: 600;
            cursor: pointer;
            transition: color var(--curve);
        }
        .ledger-entry .redo:hover { color: var(--primary); }
        @media (max-width: 500px) {
            .elite { padding: 2.5rem; }
            h1 { font-size: 2.5rem; }
            input, .deploy-btn { font-size: 1.15rem; padding: 1.5rem; }
            .alert, .ledger-entry { font-size: 1rem; }
        }
        @keyframes pulse-ring {
            0%, 100% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.8); opacity: 0.2; }
        }
        @keyframes spin { to { transform: translate(-50%, -50%) rotate(360deg); } }
    </style>
</head>
<body>
    <div class="backdrop">
        <div class="pulse-ring"></div>
        <div class="pulse-ring"></div>
        <div class="pulse-ring"></div>
    </div>
    <div class="elite">
        <h1>Nexus <span>Elite</span></h1>
        <div class="input-zone">
            <input type="text" id="extInput" placeholder="Extension ID or Chrome Store URL">
            <span class="input-signal">ðŸ”—</span>
        </div>
        <button class="deploy-btn" id="deploy">Deploy Extension</button>
        <div class="alert" id="alert"></div>
        <div class="ledger" id="ledger"></div>
    </div>
    <script>
        const DOM = {
            deploy: document.getElementById("deploy"),
            extInput: document.getElementById("extInput"),
            alert: document.getElementById("alert"),
            ledger: document.getElementById("ledger")
        };

        const Security = {
            generateToken: () => crypto.getRandomValues(new Uint32Array(2)).join("") + Date.now().toString(36),
            extractId: (input) => {
                input = input.trim();
                const urlPattern = /chrome\.google\.com\/webstore\/detail\/[^/]+\/([a-z]{32})/i;
                const idPattern = /^[a-z]{32}$/;
                const urlMatch = input.match(urlPattern);
                return urlMatch ? urlMatch[1] : (idPattern.test(input) ? input : null);
            },
            cleanId: (id) => id.toLowerCase().replace(/[^a-z]/g, "").slice(0, 32),
            isSecureContext: () => window.isSecureContext || location.hostname === "localhost",
            rateLimit: (() => {
                const limits = new Map();
                return (key, max = 5, windowMs = 60000) => {
                    const now = performance.now();
                    const record = limits.get(key) || { count: 0, start: now };
                    if (now - record.start > windowMs) {
                        record.count = 0;
                        record.start = now;
                    }
                    record.count++;
                    limits.set(key, record);
                    return record.count <= max;
                };
            })(),
            verifyEnvironment: () => {
                const ua = navigator.userAgent.toLowerCase();
                return !(/bot|crawl|spider|headless/.test(ua) || navigator.webdriver || !window.performance.timing);
            }
        };

        const Browser = {
            detect: () => {
                const ua = navigator.userAgent.toLowerCase();
                const vendor = navigator.vendor.toLowerCase();
                const rules = [
                    { name: "Chrome", test: () => /chrome/.test(ua) && /google/.test(vendor) && !/opr|edg/.test(ua) },
                    { name: "Firefox", test: () => /firefox/.test(ua) && /mozilla/.test(vendor) },
                    { name: "Opera", test: () => /opr/.test(ua) && /opera/.test(vendor) },
                    { name: "Edge", test: () => /edg/.test(ua) },
                    { name: "Safari", test: () => /safari/.test(ua) && /apple/.test(vendor) && !/chrome/.test(ua) }
                ];
                const match = rules.find(rule => rule.test());
                return match ? match.name : "Other";
            },
            supportsInlineInstall: () => typeof chrome !== "undefined" && !!chrome.webstore && window.isSecureContext
        };

        const Extension = {
            registry: new Map(),
            installViaStore: (id) => {
                return new Promise((resolve, reject) => {
                    if (!Browser.supportsInlineInstall()) {
                        return reject(new Error("This browser does not support inline installation"));
                    }
                    chrome.webstore.install(
                        `https://chrome.google.com/webstore/detail/${id}`,
                        () => resolve({ success: true, message: "Extension deployed via Chrome Web Store" }),
                        (error) => reject(new Error(error || "User cancelled or installation failed"))
                    );
                });
            },
            simulateInstall: (id, browser) => {
                const manifest = {
                    manifest_version: 3,
                    name: `Nexus-${id.slice(0, 6)}`,
                    version: "1.0.0",
                    permissions: ["activeTab", "storage"],
                    background: { service_worker: "background.js" }
                };
                return new Promise((resolve) => {
                    setTimeout(() => {
                        if (browser === "Chrome") {
                            Extension.registry.set(id, { manifest, active: true, deployedAt: Date.now() });
                            resolve({ success: true, message: `${manifest.name} deployed successfully` });
                        } else {
                            resolve({ success: false, message: `${browser} requires manual deployment from its extension settings` });
                        }
                    }, 800);
                });
            },
            isDeployed: (id) => Extension.registry.has(id)
        };

        const Ledger = {
            entries: JSON.parse(localStorage.getItem("nexusEliteLedger") || "[]"),
            metrics: JSON.parse(localStorage.getItem("nexusEliteMetrics") || '{"attempts":0,"successes":0}"),
            initialize: () => {
                Ledger.entries = Ledger.entries.filter(e => Date.now() - e.timestamp < 90 * 24 * 60 * 60 * 1000);
                localStorage.setItem("nexusEliteLedger", JSON.stringify(Ledger.entries));
                Ledger.render();
            },
            log: (id, browser, status, message) => {
                Ledger.entries.unshift({ id, browser, status, message, timestamp: Date.now() });
                Ledger.entries = Ledger.entries.slice(0, 35);
                Ledger.metrics.attempts++;
                if (status === "Success") Ledger.metrics.successes++;
                localStorage.setItem("nexusEliteLedger", JSON.stringify(Ledger.entries));
                localStorage.setItem("nexusEliteMetrics", JSON.stringify(Ledger.metrics));
                Ledger.render();
            },
            render: () => {
                DOM.ledger.innerHTML = Ledger.entries.map(e => `
                    <div class="ledger-entry">
                        <span>${e.id.slice(0, 6)}... (${e.browser}) - ${e.status}</span>
                        <span class="redo" onclick="Elite.redeploy('${e.id}')">Redeploy</span>
                    </div>
                `).join("");
                DOM.ledger.classList.toggle("show", Ledger.entries.length > 0);
            },
            stats: () => {
                const { attempts, successes } = Ledger.metrics;
                return {
                    total: attempts,
                    successRate: attempts ? ((successes / attempts) * 100).toFixed(1) : 0
                };
            }
        };

        const Elite = {
            setLoading: (state) => {
                DOM.deploy.classList.toggle("loading", state);
                DOM.deploy.disabled = state;
                DOM.deploy.textContent = state ? "" : "Deploy Extension";
            },
            showAlert: (msg, type) => {
                DOM.alert.textContent = msg;
                DOM.alert.style.color = { success: "--success", error: "--error", info: "--primary" }[type] || "--neutral";
                DOM.alert.classList.add("show");
                setTimeout(() => DOM.alert.classList.remove("show"), 8000);
            },
            redeploy: (id) => {
                DOM.extInput.value = id;
                Elite.deploy();
            },
            showMetrics: () => {
                const { total, successRate } = Ledger.stats();
                Elite.showAlert(`Deployments: ${total} | Success: ${successRate}%`, "info");
            },
            deploy: async () => {
                const input = DOM.extInput.value.trim();
                const id = Security.extractId(input);
                const browser = Browser.detect();
                const token = Security.generateToken();

                if (!input) return Elite.showAlert("Enter an extension ID or URL", "error");
                if (!id) return Elite.showAlert("Invalid format. Use a 32-letter ID or Chrome Web Store URL", "error");
                if (!Security.isSecureContext()) return Elite.showAlert("HTTPS required for secure deployment", "error");
                if (!Security.verifyEnvironment()) return Elite.showAlert("Suspicious environment detected", "error");
                if (!Security.rateLimit("deploy")) return Elite.showAlert("Rate limit hit. Wait a minute.", "error");
                if (Extension.isDeployed(id)) return Elite.showAlert("Extension already deployed", "error");

                Elite.setLoading(true);
                Elite.showAlert(`Deploying ${id.slice(0, 6)}... on ${browser}`, "info");

                try {
                    let outcome;
                    if (browser === "Chrome" && Browser.supportsInlineInstall()) {
                        try {
                            outcome = await Extension.installViaStore(id);
                        } catch (storeErr) {
                            Elite.showAlert("Store deployment unavailable, using fallback", "info");
                            outcome = await Extension.simulateInstall(id, browser);
                        }
                    } else {
                        outcome = await Extension.simulateInstall(id, browser);
                    }
                    Elite.showAlert(outcome.message, outcome.success ? "success" : "error");
                    Ledger.log(id, browser, outcome.success ? "Success" : "Failed", outcome.message);
                    if (outcome.success) DOM.extInput.value = "";
                } catch (err) {
                    Elite.showAlert(`Deployment failed: ${err.message || "Unknown error"}`, "error");
                    Ledger.log(id, browser, "Error", err.message || "Unknown error");
                } finally {
                    Elite.setLoading(false);
                }
            }
        };

        DOM.deploy.addEventListener("click", Elite.deploy);
        DOM.extInput.addEventListener("keypress", (e) => e.key === "Enter" && Elite.deploy());
        DOM.extInput.addEventListener("input", () => DOM.alert.classList.remove("show"));
        DOM.deploy.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            Elite.showMetrics();
        });
        window.addEventListener("load", () => {
            Ledger.initialize();
            if (!Security.isSecureContext()) Elite.showAlert("Warning: HTTPS is critical for full functionality", "error");
            if (Browser.supportsInlineInstall()) {
                const script = document.createElement("script");
                script.src = "https://chrome.google.com/webstore/install-button.js";
                script.async = true;
                script.onload = () => console.log("Chrome Web Store script loaded");
                script.onerror = () => Elite.showAlert("Failed to load Chrome Web Store support", "error");
                document.head.appendChild(script);
            }
        });
    </script>
</body>
</html>
